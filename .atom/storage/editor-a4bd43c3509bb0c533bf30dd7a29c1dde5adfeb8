{"mode":"editor","version":1,"grammars":{"grammarOverridesByPath":{}},"project":{"deserializer":"Project","paths":["/Users/anas/projects/node-server"],"buffers":[{"text":"\nvar P = require('bluebird');\n\nvar orm = pRequire('/orm');\nvar auth = pRequire('/lib/auth');\nvar error = pRequire('/lib/error');\nvar log = pRequire('/lib/log');\nvar idgen = pRequire('/lib/idgen');\nvar apiUtil = pRequire('/lib/api-util');\nvar modelUtil = pRequire('/lib/model-util');\nvar UserManager = pRequire('/managers/user-manager');\nvar PlatformManager = pRequire('/managers/platform-manager');\n\nvar songController = require('./song-controller');\nvar subscriptionController = require('./subscription-controller');\n\nfunction getUserSecret(user) {\n  return orm.getModel('usersecret').findOne({user_id: user.user_id}).then(function(userSecret) {\n    if(userSecret) {\n      return userSecret.secret;\n    }\n\n    return P.reject(error.notFound('user password hash not found'));\n  });\n}\n\nvar bcrypt = require('../../lib/bcrypt');\nvar bcryptCompare = P.promisify(bcrypt.compare);\n\nfunction checkPassword(user, password) {\n  return getUserSecret(user).then(function(userSecret) {\n    return bcryptCompare(password, userSecret);\n  }).then(function(isValid) {\n    if(isValid) {\n      return;\n    } else {\n      return P.reject(error.accessDenied({ errorType: 'incorrectPassword', message: 'Incorrect password'}));\n    }\n  }).then(null, function(err) {\n    if((err.notFound || err.accessDenied) && user.facebook_id) {\n      return P.reject(error.notFound({ errorType: 'userHasFacebook', message: 'Incorrect password, did you use Facebook?' }));\n    } else {\n      return P.reject(err);\n    }\n  });\n}\n\nfunction checkCredentials(username, password) {\n  return UserManager.getByUsername(username)\n    .catch(function() {\n      return UserManager.getByEmail(username);\n    }).then(function(user) {\n      return checkPassword(user, password).then(function() {\n        return user;\n      });\n    }, function(err) {\n      if(err.errorType === 'userNotFound') {\n        return P.reject(error.notFound({ errorType: 'userNotFound', message: 'User not found, did you use Facebook?' }));\n      } else {\n        return P.reject(err);\n      }\n    });\n}\nexports.checkCredentials = checkCredentials;\n\n// Facebook\n\nfunction createNewUserFromFacebook(profile, platformName) {\n  var email = null;\n\n  try { email = profile.emails[0].value.toLowerCase(); }\n  catch(err) {  } // no email\n\n  return UserManager.getByEmail(email)\n    .then(function(user) {\n      user.facebook_id = profile.id;\n\n      return user.save();\n    }, function(err) {\n      if(err.notFound) { // No email, or no user found for that email\n        return P.join(idgen.generateId(), PlatformManager.getByName(platformName),\n          function(userId, platform) {\n            return UserManager.create({\n              user_id: userId,\n              username: userId,\n              display_name: profile.displayName,\n              email: email,\n              user_type: 'normal_user',\n              password_hash: '',\n              facebook_id: profile.id,\n              registration_app_id: platform.app_id,\n              registration_date: new Date()\n            });\n          });\n      } else { // database error\n        return P.reject(err);\n      }\n    });\n}\n\nfunction checkFacebook(accessToken, refreshToken, profile, platform) {\n  return UserManager.getByFacebookId(profile.id) // Find existing user\n    .catch(function() {\n      return createNewUserFromFacebook(profile, platform).then(function(user) {\n        // send welcome email here\n\n        return user;\n      });\n    });\n}\nexports.checkFacebook = checkFacebook;\n\nfunction update(user, data) {\n  return modelUtil.update(user,\n    ['description', 'country', 'location', 'tagline', 'display_name'],\n    data);\n}\nexports.update = update;\n\nfunction getSongCount(user) {\n  return P.props({\n    subscriptionStatus: subscriptionController.getSubscriptionStatus(user),\n    songCount: songController.getSongCount(user)\n  }).then(function(result) {\n    var count = result.songCount;\n\n    if(result.subscriptionStatus.subscription_name === 'free') {\n      return {\n        count: count,\n        remaining: 10 - count,\n        limit: 10\n      };\n    } else {\n      return {\n        count: count,\n        remaining: null,\n        limit: null\n      };\n    }\n  });\n}\nexports.getSongCount = getSongCount;\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"nextMarkerId":54,"id":"0","maintainHistory":false,"markersById":{"0-0":{"range":{"start":{"row":17,"column":2},"end":{"row":17,"column":96}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-1":{"range":{"start":{"row":17,"column":2},"end":{"row":17,"column":96}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-2":{"range":{"start":{"row":17,"column":2},"end":{"row":17,"column":96}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-3":{"range":{"start":{"row":17,"column":2},"end":{"row":17,"column":96}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-4":{"range":{"start":{"row":17,"column":2},"end":{"row":17,"column":96}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-5":{"range":{"start":{"row":17,"column":2},"end":{"row":17,"column":96}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-6":{"range":{"start":{"row":18,"column":4},"end":{"row":18,"column":20}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-7":{"range":{"start":{"row":18,"column":4},"end":{"row":18,"column":20}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-8":{"range":{"start":{"row":19,"column":6},"end":{"row":19,"column":31}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-9":{"range":{"start":{"row":20,"column":4},"end":{"row":20,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-10":{"range":{"start":{"row":22,"column":4},"end":{"row":22,"column":68}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-11":{"range":{"start":{"row":23,"column":2},"end":{"row":23,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-12":{"range":{"start":{"row":30,"column":2},"end":{"row":30,"column":56}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-13":{"range":{"start":{"row":30,"column":2},"end":{"row":30,"column":56}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-14":{"range":{"start":{"row":31,"column":4},"end":{"row":31,"column":47}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-15":{"range":{"start":{"row":32,"column":2},"end":{"row":32,"column":29}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-16":{"range":{"start":{"row":32,"column":2},"end":{"row":32,"column":29}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-17":{"range":{"start":{"row":33,"column":4},"end":{"row":33,"column":17}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-18":{"range":{"start":{"row":33,"column":4},"end":{"row":33,"column":17}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-19":{"range":{"start":{"row":34,"column":6},"end":{"row":34,"column":13}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-20":{"range":{"start":{"row":35,"column":4},"end":{"row":35,"column":12}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-21":{"range":{"start":{"row":35,"column":4},"end":{"row":35,"column":12}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-22":{"range":{"start":{"row":36,"column":6},"end":{"row":36,"column":108}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-23":{"range":{"start":{"row":36,"column":6},"end":{"row":36,"column":108}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-24":{"range":{"start":{"row":37,"column":4},"end":{"row":37,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-25":{"range":{"start":{"row":38,"column":2},"end":{"row":38,"column":31}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-26":{"range":{"start":{"row":38,"column":2},"end":{"row":38,"column":31}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-27":{"range":{"start":{"row":39,"column":4},"end":{"row":39,"column":64}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-28":{"range":{"start":{"row":39,"column":4},"end":{"row":39,"column":64}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-29":{"range":{"start":{"row":39,"column":4},"end":{"row":39,"column":64}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-30":{"range":{"start":{"row":40,"column":6},"end":{"row":40,"column":126}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-31":{"range":{"start":{"row":40,"column":6},"end":{"row":40,"column":126}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-32":{"range":{"start":{"row":41,"column":4},"end":{"row":41,"column":12}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-33":{"range":{"start":{"row":41,"column":4},"end":{"row":41,"column":12}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-34":{"range":{"start":{"row":42,"column":6},"end":{"row":42,"column":27}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-35":{"range":{"start":{"row":43,"column":4},"end":{"row":43,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-36":{"range":{"start":{"row":44,"column":2},"end":{"row":44,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-37":{"range":{"start":{"row":48,"column":2},"end":{"row":48,"column":44}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-38":{"range":{"start":{"row":49,"column":4},"end":{"row":49,"column":23}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-39":{"range":{"start":{"row":50,"column":6},"end":{"row":50,"column":46}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-40":{"range":{"start":{"row":51,"column":4},"end":{"row":51,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-41":{"range":{"start":{"row":52,"column":6},"end":{"row":52,"column":60}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-42":{"range":{"start":{"row":52,"column":6},"end":{"row":52,"column":60}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-43":{"range":{"start":{"row":53,"column":8},"end":{"row":53,"column":20}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-44":{"range":{"start":{"row":54,"column":6},"end":{"row":54,"column":9}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-45":{"range":{"start":{"row":55,"column":4},"end":{"row":55,"column":22}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-46":{"range":{"start":{"row":56,"column":6},"end":{"row":56,"column":44}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-47":{"range":{"start":{"row":56,"column":6},"end":{"row":56,"column":44}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-48":{"range":{"start":{"row":57,"column":8},"end":{"row":57,"column":121}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-49":{"range":{"start":{"row":57,"column":8},"end":{"row":57,"column":121}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-50":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-51":{"range":{"start":{"row":4,"column":4},"end":{"row":4,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-52":{"range":{"start":{"row":6,"column":4},"end":{"row":6,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-53":{"range":{"start":{"row":8,"column":4},"end":{"row":8,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"}},"version":2},"1":{"nextMarkerId":0,"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"nextMarkerId":1,"id":"2","maintainHistory":true,"markersById":{"2-0":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2}},"nextMarkerLayerId":3,"history":{"version":3,"nextCheckpointId":2,"undoStack":[{"type":"checkpoint","id":1,"snapshot":{"2":{"2-0":{"range":[[0,0],[0,0]],"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}}},"isBoundary":false}],"redoStack":[]},"encoding":"utf8","filePath":"/Users/anas/projects/node-server/src/controllers/user-controller.js","digestWhenLastPersisted":"58b6fbe81e996deb063aafdc33bb6928d30ab689","preferredLineEnding":null,"deserializer":"TextBuffer","version":4},{"text":"\nvar _ = require('underscore');\nvar P = require('bluebird');\nvar GroupController = pRequire('/controllers/group-controller');\nvar apiUtil = pRequire('/lib/api-util');\nvar error = pRequire('/lib/error');\n\nfunction requireLogin(req, res, next) {\n  if(req.user) {\n    next();\n  } else {\n    apiUtil.sendError(res, error.accessDenied({ errorType: 'loginRequired' }));\n  }\n}\nexports.requireLogin = requireLogin;\n\nvar requireAdminM = [\n  requireLogin,\n  function(req, res, next) {\n    if(req.user.isAdmin()) {\n      next();\n    } else {\n      apiUtil.sendError(res, error.accessDenied({ errorType: 'adminRequired' }));\n    }\n  }\n];\n\nfunction requireAdmin() {\n  return requireAdminM;\n}\nexports.requireAdmin = requireAdmin;\n\nfunction normalizePermissions(permissions) {\n  var out = {};\n\n  permissions = permissions || {};\n  out.global_permissions = permissions.global_permissions || {};\n  out.user_permissions = permissions.user_permissions || [];\n  out.group_permissions = permissions.group_permissions || [];\n\n  return out;\n}\n\nfunction mergePermissions(permissionsList) {\n  var out = {};\n\n  _.each(permissionsList, function(permissions) {\n    _.each(permissions, function(value, key) {\n      if(value) { out[key] = true; }\n    });\n  });\n\n  return out;\n}\n\nfunction getUserPermissions(permissions, user) {\n  return _.find(permissions.user_permissions, function(user_permission) {\n    return user_permission.user_id === user.user_id;\n  });\n}\n\nfunction getGroupPermissions(permissions, user) {\n  var groupPermissions = permissions.group_permissions;\n\n  return P.all(_.map(groupPermissions, function(permissions) {\n    return GroupController.isMember(permissions.group_id, user.user_id).then(function(isMember) {\n      if(isMember) {\n        return permissions;\n      } else {\n        return {};\n      }\n    });\n  })).then(function(permissionsList) {\n    return mergePermissions(permissionsList);\n  });\n}\n\nfunction extractCurrentPermissions(permissions, user) {\n  permissions = normalizePermissions(permissions);\n\n  if(user) {\n    return getGroupPermissions(permissions, user).then(function(groupPermissions) {\n      return mergePermissions([\n        permissions.global_permissions,\n        getUserPermissions(permissions, user),\n        groupPermissions\n      ]);\n    });\n  } else {\n    return P.resolve(permissions.global_permissions);\n  }\n}\nexports.extractCurrentPermissions = extractCurrentPermissions;\n\nfunction requirePermission(getCurrentPermissions, permission_list) {\n  return function(req, res, next) {\n    getCurrentPermissions(req, res).then(function(currentPermissions) {\n      var isAllowed = _.every(permission_list, function(test_permission) {\n        return currentPermissions[test_permission];\n      });\n\n      if(isAllowed) {\n        next();\n      } else {\n        apiUtil.sendError(res, error.accessDenied('You don\\'t have permission to view this content. :('));\n      }\n    }, function(err) {\n      apiUtil.sendError(res, err);\n    });\n  };\n}\nexports.requirePermission = requirePermission;\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"nextMarkerId":52,"id":"0","maintainHistory":false,"markersById":{"0-0":{"range":{"start":{"row":8,"column":2},"end":{"row":8,"column":16}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-1":{"range":{"start":{"row":8,"column":2},"end":{"row":8,"column":16}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-2":{"range":{"start":{"row":9,"column":4},"end":{"row":9,"column":11}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-3":{"range":{"start":{"row":10,"column":2},"end":{"row":10,"column":10}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-4":{"range":{"start":{"row":10,"column":2},"end":{"row":10,"column":10}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-5":{"range":{"start":{"row":11,"column":4},"end":{"row":11,"column":79}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-6":{"range":{"start":{"row":12,"column":2},"end":{"row":12,"column":3}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-7":{"range":{"start":{"row":18,"column":2},"end":{"row":18,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-8":{"range":{"start":{"row":19,"column":4},"end":{"row":19,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-9":{"range":{"start":{"row":19,"column":4},"end":{"row":19,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-10":{"range":{"start":{"row":20,"column":6},"end":{"row":20,"column":13}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-11":{"range":{"start":{"row":21,"column":4},"end":{"row":21,"column":12}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-12":{"range":{"start":{"row":21,"column":4},"end":{"row":21,"column":12}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-13":{"range":{"start":{"row":22,"column":6},"end":{"row":22,"column":81}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-14":{"range":{"start":{"row":23,"column":4},"end":{"row":23,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-15":{"range":{"start":{"row":28,"column":2},"end":{"row":28,"column":23}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-16":{"range":{"start":{"row":33,"column":2},"end":{"row":33,"column":15}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-17":{"range":{"start":{"row":35,"column":2},"end":{"row":35,"column":34}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-18":{"range":{"start":{"row":36,"column":2},"end":{"row":36,"column":64}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-19":{"range":{"start":{"row":36,"column":2},"end":{"row":36,"column":64}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-20":{"range":{"start":{"row":36,"column":2},"end":{"row":36,"column":64}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-21":{"range":{"start":{"row":37,"column":2},"end":{"row":37,"column":60}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-22":{"range":{"start":{"row":37,"column":2},"end":{"row":37,"column":60}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-23":{"range":{"start":{"row":37,"column":2},"end":{"row":37,"column":60}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-24":{"range":{"start":{"row":38,"column":2},"end":{"row":38,"column":62}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-25":{"range":{"start":{"row":38,"column":2},"end":{"row":38,"column":62}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-26":{"range":{"start":{"row":38,"column":2},"end":{"row":38,"column":62}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-27":{"range":{"start":{"row":40,"column":2},"end":{"row":40,"column":13}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-28":{"range":{"start":{"row":44,"column":2},"end":{"row":44,"column":15}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-29":{"range":{"start":{"row":46,"column":2},"end":{"row":46,"column":49}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-30":{"range":{"start":{"row":46,"column":2},"end":{"row":46,"column":49}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-31":{"range":{"start":{"row":47,"column":4},"end":{"row":47,"column":46}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-32":{"range":{"start":{"row":47,"column":4},"end":{"row":47,"column":46}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-33":{"range":{"start":{"row":48,"column":6},"end":{"row":48,"column":36}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-34":{"range":{"start":{"row":48,"column":6},"end":{"row":48,"column":36}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-35":{"range":{"start":{"row":48,"column":6},"end":{"row":48,"column":36}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-36":{"range":{"start":{"row":48,"column":6},"end":{"row":48,"column":36}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-37":{"range":{"start":{"row":49,"column":4},"end":{"row":49,"column":7}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-38":{"range":{"start":{"row":50,"column":2},"end":{"row":50,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-39":{"range":{"start":{"row":52,"column":2},"end":{"row":52,"column":13}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-40":{"range":{"start":{"row":56,"column":2},"end":{"row":56,"column":73}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-41":{"range":{"start":{"row":56,"column":2},"end":{"row":56,"column":73}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-42":{"range":{"start":{"row":56,"column":2},"end":{"row":56,"column":73}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-43":{"range":{"start":{"row":56,"column":2},"end":{"row":56,"column":73}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-44":{"range":{"start":{"row":57,"column":4},"end":{"row":57,"column":52}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-45":{"range":{"start":{"row":57,"column":4},"end":{"row":57,"column":52}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-46":{"range":{"start":{"row":57,"column":4},"end":{"row":57,"column":52}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-47":{"range":{"start":{"row":57,"column":4},"end":{"row":57,"column":52}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-48":{"range":{"start":{"row":58,"column":2},"end":{"row":58,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-49":{"range":{"start":{"row":62,"column":2},"end":{"row":62,"column":55}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-50":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-51":{"range":{"start":{"row":1,"column":4},"end":{"row":1,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"}},"version":2},"1":{"nextMarkerId":0,"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"nextMarkerId":1,"id":"2","maintainHistory":true,"markersById":{"2-0":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2}},"nextMarkerLayerId":3,"history":{"version":3,"nextCheckpointId":2,"undoStack":[{"type":"checkpoint","id":1,"snapshot":{"2":{"2-0":{"range":[[0,0],[0,0]],"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}}},"isBoundary":false}],"redoStack":[]},"encoding":"utf8","filePath":"/Users/anas/projects/node-server/src/lib/auth.js","digestWhenLastPersisted":"1937c1040b93b00d4d3f4b79acf008515b56d27f","preferredLineEnding":null,"deserializer":"TextBuffer","version":4},{"text":"\nvar P = require('bluebird');\nvar orm = pRequire('/orm');\nvar error = pRequire('/lib/error');\n\n// Returns a model instance of models/user\nfunction getModel() {\n  return orm.getModel('user');\n}\nexports.getModel = getModel;\n\nfunction create(data) {\n  return getModel().create(data);\n}\nexports.create = create;\n\nfunction getByProperty(queryObj) {\n  return getModel().findOne(queryObj).then(function(user) {\n    if(user) { return user; }\n    \n    return P.reject(error.notFound({ errorType: 'userNotFound', message: 'User not found'}));\n  });\n}\nexports.getByProperty = getByProperty;\n\nfunction getById(id) {\n  return getByProperty({user_id: id});\n}\nexports.getById = getById;\n\nfunction getByUsername(username) {\n  return getByProperty({username: username});\n}\nexports.getByUsername = getByUsername;\n\nfunction getByEmail(email) {\n  if(!email) { return P.reject(error.notFound('no email provided')); }\n  return getByProperty({email: email});\n}\nexports.getByEmail = getByEmail;\n\nfunction getByFacebookId(id) {\n  if(!id) { return P.reject(error.notFound('no facebook id provided')); }\n  return getByProperty({facebook_id: id});\n}\nexports.getByFacebookId = getByFacebookId;\n\nfunction getMailingListQueueModel() {\n  return orm.getModel('mailing_list_queue');\n}\n\nfunction addUserToMailingList(user) {\n  return getMailingListQueueModel().create({user_id: user.user_id, handled: false}).then(function() {\n    return user;\n  });\n}\nexports.addUserToMailingList = addUserToMailingList;\n\n////\n//// Subscription status\n\nfunction getSubscriptionStatusModel() {\n  return orm.getModel('user_subscription_status');\n}\n\nfunction getSubscriptionStatus(user) {\n  return getSubscriptionStatusModel().findOne({ user_id: user.user_id }).then(function(status) {\n    if(status) { return status; }\n    \n    throw error.notFound('user subscription status not found');\n  });\n}\nexports.getSubscriptionStatus = getSubscriptionStatus;\n\nfunction getSubscriptionStatusOrNull(user) {\n  return getSubscriptionStatus(user).then(null, function() {\n    return null;\n  });\n}\nexports.getSubscriptionStatusOrNull = getSubscriptionStatusOrNull;\n\nfunction createSubscriptionStatus(user) {\n  return getSubscriptionStatusModel().create({ user_id: user.user_id }).then(function(status) {\n    return status;\n  });\n}\nexports.createSubscriptionStatus = createSubscriptionStatus;\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"nextMarkerId":51,"id":"0","maintainHistory":false,"markersById":{"0-0":{"range":{"start":{"row":7,"column":2},"end":{"row":7,"column":30}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-1":{"range":{"start":{"row":12,"column":2},"end":{"row":12,"column":33}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-2":{"range":{"start":{"row":17,"column":2},"end":{"row":17,"column":59}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-3":{"range":{"start":{"row":17,"column":2},"end":{"row":17,"column":59}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-4":{"range":{"start":{"row":18,"column":4},"end":{"row":18,"column":29}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-5":{"range":{"start":{"row":18,"column":4},"end":{"row":18,"column":29}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-6":{"range":{"start":{"row":18,"column":4},"end":{"row":18,"column":29}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-7":{"range":{"start":{"row":18,"column":4},"end":{"row":18,"column":29}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-8":{"range":{"start":{"row":19,"column":4},"end":{"row":19,"column":4}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-9":{"range":{"start":{"row":20,"column":4},"end":{"row":20,"column":93}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-10":{"range":{"start":{"row":20,"column":4},"end":{"row":20,"column":93}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-11":{"range":{"start":{"row":21,"column":2},"end":{"row":21,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-12":{"range":{"start":{"row":26,"column":2},"end":{"row":26,"column":38}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-13":{"range":{"start":{"row":26,"column":2},"end":{"row":26,"column":38}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-14":{"range":{"start":{"row":26,"column":2},"end":{"row":26,"column":38}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-15":{"range":{"start":{"row":26,"column":2},"end":{"row":26,"column":38}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-16":{"range":{"start":{"row":31,"column":2},"end":{"row":31,"column":45}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-17":{"range":{"start":{"row":31,"column":2},"end":{"row":31,"column":45}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-18":{"range":{"start":{"row":31,"column":2},"end":{"row":31,"column":45}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-19":{"range":{"start":{"row":36,"column":2},"end":{"row":36,"column":70}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-20":{"range":{"start":{"row":36,"column":2},"end":{"row":36,"column":70}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-21":{"range":{"start":{"row":36,"column":2},"end":{"row":36,"column":70}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-22":{"range":{"start":{"row":36,"column":2},"end":{"row":36,"column":70}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-23":{"range":{"start":{"row":37,"column":2},"end":{"row":37,"column":39}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-24":{"range":{"start":{"row":37,"column":2},"end":{"row":37,"column":39}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-25":{"range":{"start":{"row":37,"column":2},"end":{"row":37,"column":39}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-26":{"range":{"start":{"row":42,"column":2},"end":{"row":42,"column":73}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-27":{"range":{"start":{"row":42,"column":2},"end":{"row":42,"column":73}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-28":{"range":{"start":{"row":42,"column":2},"end":{"row":42,"column":73}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-29":{"range":{"start":{"row":42,"column":2},"end":{"row":42,"column":73}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-30":{"range":{"start":{"row":43,"column":2},"end":{"row":43,"column":42}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-31":{"range":{"start":{"row":43,"column":2},"end":{"row":43,"column":42}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-32":{"range":{"start":{"row":43,"column":2},"end":{"row":43,"column":42}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-33":{"range":{"start":{"row":43,"column":2},"end":{"row":43,"column":42}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-34":{"range":{"start":{"row":48,"column":2},"end":{"row":48,"column":44}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-35":{"range":{"start":{"row":52,"column":2},"end":{"row":52,"column":101}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-36":{"range":{"start":{"row":52,"column":2},"end":{"row":52,"column":101}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-37":{"range":{"start":{"row":52,"column":2},"end":{"row":52,"column":101}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-38":{"range":{"start":{"row":52,"column":2},"end":{"row":52,"column":101}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-39":{"range":{"start":{"row":52,"column":2},"end":{"row":52,"column":101}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-40":{"range":{"start":{"row":52,"column":2},"end":{"row":52,"column":101}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-41":{"range":{"start":{"row":53,"column":4},"end":{"row":53,"column":16}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-42":{"range":{"start":{"row":54,"column":2},"end":{"row":54,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-43":{"range":{"start":{"row":58,"column":0},"end":{"row":58,"column":4}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-44":{"range":{"start":{"row":59,"column":0},"end":{"row":59,"column":24}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-45":{"range":{"start":{"row":62,"column":2},"end":{"row":62,"column":50}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-46":{"range":{"start":{"row":66,"column":2},"end":{"row":66,"column":96}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-47":{"range":{"start":{"row":66,"column":2},"end":{"row":66,"column":96}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-48":{"range":{"start":{"row":66,"column":2},"end":{"row":66,"column":96}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-49":{"range":{"start":{"row":66,"column":2},"end":{"row":66,"column":96}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-50":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"}},"version":2},"1":{"nextMarkerId":0,"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"nextMarkerId":1,"id":"2","maintainHistory":true,"markersById":{"2-0":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2}},"nextMarkerLayerId":3,"history":{"version":3,"nextCheckpointId":2,"undoStack":[{"type":"checkpoint","id":1,"snapshot":{"2":{"2-0":{"range":[[0,0],[0,0]],"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}}},"isBoundary":false}],"redoStack":[]},"encoding":"utf8","filePath":"/Users/anas/projects/node-server/src/managers/user-manager.js","digestWhenLastPersisted":"bac0a3c50abd9225e17a0fa45952d4322b921394","preferredLineEnding":null,"deserializer":"TextBuffer","version":4},{"text":"\nvar _ = require('underscore');\nvar Waterline = require('waterline');\n\nvar util = pRequire('/lib/util');\n\nmodule.exports = Waterline.Collection.extend({\n  identity: 'user',\n  tableName: 'user_info',\n  connection: 'pgConnection',\n\n  attributes: {\n    user_id: {\n      type: 'string',\n      required: true,\n      unique: true,\n      primaryKey: true,\n      size: 32\n    },\n\n    username: {\n      type: 'text',\n      required: true,\n      unique: true\n    },\n\n    display_name: {\n      type: 'text'\n    },\n\n    email: {\n      type: 'text',\n      unique: true\n    },\n\n    user_type: {\n      type: 'string',\n      enum: [\n        'anonymous_registered', 'hashcash_registered',\n        'unverified_email', 'normal_user', 'paid_user',\n        'moderator', 'root'\n      ]\n    },\n\n    registration_app_id: {\n      type: 'integer'\n    },\n\n    registration_date: {\n      type: 'date'\n    },\n\n    facebook_id: {\n      type: 'string',\n      unique: true\n    },\n\n    comments: {\n      collection: 'comment',\n      via: 'user'\n    },\n\n    description: {\n      type: 'text',\n      maxLength: 2000\n    },\n\n    country: {\n      type: 'string',\n      size: 255\n    },\n\n    location: {\n      type: 'string',\n      size: 255\n    },\n\n    tagline: {\n      type: 'string',\n      size: 255\n    },\n\n    isAdmin: function() {\n      return this.user_type === 'root';\n    },\n\n    getSimpleObject: function() {\n      var out = _.pick(this.toObject(), 'user_id', 'username', 'display_name');\n\n      out.registration_date = util.dateToSeconds(this.registration_date);\n      out.display_name = out.display_name || out.username;\n\n      return out;\n    },\n\n    getPrivateObject: function() {\n      var pub = this.getPublicObject();\n      var priv = _.pick(this.toObject(), 'email', 'facebook_id', 'subscription_status');\n      priv.subscription = [];\n\n      return _.extend({}, pub, priv);\n    },\n\n    getPublicObject: function() {\n      var out = _.pick(this.toObject(),\n        'user_id', 'username', 'display_name', 'description',\n        'country', 'location', 'tagline', 'user_type');\n\n      out.registration_date = util.dateToSeconds(this.registration_date);\n      out.display_name = out.display_name || out.username;\n\n      return out;\n    }\n  }\n});\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"nextMarkerId":52,"id":"0","maintainHistory":false,"markersById":{"0-0":{"range":{"start":{"row":7,"column":2},"end":{"row":7,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-1":{"range":{"start":{"row":8,"column":2},"end":{"row":8,"column":25}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-2":{"range":{"start":{"row":9,"column":2},"end":{"row":9,"column":29}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-3":{"range":{"start":{"row":11,"column":2},"end":{"row":11,"column":15}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-4":{"range":{"start":{"row":12,"column":4},"end":{"row":12,"column":14}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-5":{"range":{"start":{"row":12,"column":4},"end":{"row":12,"column":14}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-6":{"range":{"start":{"row":13,"column":6},"end":{"row":13,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-7":{"range":{"start":{"row":14,"column":6},"end":{"row":14,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-8":{"range":{"start":{"row":15,"column":6},"end":{"row":15,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-9":{"range":{"start":{"row":16,"column":6},"end":{"row":16,"column":23}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-10":{"range":{"start":{"row":17,"column":6},"end":{"row":17,"column":14}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-11":{"range":{"start":{"row":18,"column":4},"end":{"row":18,"column":6}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-12":{"range":{"start":{"row":20,"column":4},"end":{"row":20,"column":15}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-13":{"range":{"start":{"row":21,"column":6},"end":{"row":21,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-14":{"range":{"start":{"row":22,"column":6},"end":{"row":22,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-15":{"range":{"start":{"row":23,"column":6},"end":{"row":23,"column":18}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-16":{"range":{"start":{"row":24,"column":4},"end":{"row":24,"column":6}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-17":{"range":{"start":{"row":26,"column":4},"end":{"row":26,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-18":{"range":{"start":{"row":26,"column":4},"end":{"row":26,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-19":{"range":{"start":{"row":27,"column":6},"end":{"row":27,"column":18}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-20":{"range":{"start":{"row":28,"column":4},"end":{"row":28,"column":6}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-21":{"range":{"start":{"row":30,"column":4},"end":{"row":30,"column":12}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-22":{"range":{"start":{"row":31,"column":6},"end":{"row":31,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-23":{"range":{"start":{"row":32,"column":6},"end":{"row":32,"column":18}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-24":{"range":{"start":{"row":33,"column":4},"end":{"row":33,"column":6}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-25":{"range":{"start":{"row":35,"column":4},"end":{"row":35,"column":16}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-26":{"range":{"start":{"row":35,"column":4},"end":{"row":35,"column":16}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-27":{"range":{"start":{"row":36,"column":6},"end":{"row":36,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-28":{"range":{"start":{"row":37,"column":6},"end":{"row":37,"column":13}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-29":{"range":{"start":{"row":42,"column":4},"end":{"row":42,"column":6}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-30":{"range":{"start":{"row":44,"column":4},"end":{"row":44,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-31":{"range":{"start":{"row":44,"column":4},"end":{"row":44,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-32":{"range":{"start":{"row":45,"column":6},"end":{"row":45,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-33":{"range":{"start":{"row":46,"column":4},"end":{"row":46,"column":6}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-34":{"range":{"start":{"row":48,"column":4},"end":{"row":48,"column":24}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-35":{"range":{"start":{"row":48,"column":4},"end":{"row":48,"column":24}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-36":{"range":{"start":{"row":49,"column":6},"end":{"row":49,"column":18}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-37":{"range":{"start":{"row":50,"column":4},"end":{"row":50,"column":6}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-38":{"range":{"start":{"row":52,"column":4},"end":{"row":52,"column":18}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-39":{"range":{"start":{"row":52,"column":4},"end":{"row":52,"column":18}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-40":{"range":{"start":{"row":53,"column":6},"end":{"row":53,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-41":{"range":{"start":{"row":54,"column":6},"end":{"row":54,"column":18}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-42":{"range":{"start":{"row":55,"column":4},"end":{"row":55,"column":6}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-43":{"range":{"start":{"row":57,"column":4},"end":{"row":57,"column":15}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-44":{"range":{"start":{"row":58,"column":6},"end":{"row":58,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-45":{"range":{"start":{"row":59,"column":6},"end":{"row":59,"column":17}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-46":{"range":{"start":{"row":60,"column":4},"end":{"row":60,"column":6}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-47":{"range":{"start":{"row":62,"column":4},"end":{"row":62,"column":18}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-48":{"range":{"start":{"row":63,"column":6},"end":{"row":63,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-49":{"range":{"start":{"row":64,"column":6},"end":{"row":64,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-50":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-51":{"range":{"start":{"row":1,"column":4},"end":{"row":1,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"}},"version":2},"1":{"nextMarkerId":0,"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"nextMarkerId":1,"id":"2","maintainHistory":true,"markersById":{"2-0":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2}},"nextMarkerLayerId":3,"history":{"version":3,"nextCheckpointId":2,"undoStack":[{"type":"checkpoint","id":1,"snapshot":{"2":{"2-0":{"range":[[0,0],[0,0]],"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}}},"isBoundary":false}],"redoStack":[]},"encoding":"utf8","filePath":"/Users/anas/projects/node-server/src/models/user.js","digestWhenLastPersisted":"4e941bba060065b3248d8c53831739b45ff7152b","preferredLineEnding":null,"deserializer":"TextBuffer","version":4},{"text":"\nvar Waterline = require('waterline');\n\nmodule.exports = Waterline.Collection.extend({\n  identity: 'userSecret',\n  tableName: 'user_secret',\n  connection: 'pgConnection',\n\n  attributes: {\n    user_id: {\n      type: 'string',\n      required: true,\n      unique: true,\n      primaryKey: true,\n      size: 32\n    },\n\n    secret: {\n      type: 'string',\n      size: 60,\n      require: true\n    }\n  }\n});\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"nextMarkerId":19,"id":"0","maintainHistory":false,"markersById":{"0-0":{"range":{"start":{"row":4,"column":2},"end":{"row":4,"column":25}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-1":{"range":{"start":{"row":5,"column":2},"end":{"row":5,"column":27}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-2":{"range":{"start":{"row":6,"column":2},"end":{"row":6,"column":29}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-3":{"range":{"start":{"row":8,"column":2},"end":{"row":8,"column":15}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-4":{"range":{"start":{"row":9,"column":4},"end":{"row":9,"column":14}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-5":{"range":{"start":{"row":9,"column":4},"end":{"row":9,"column":14}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-6":{"range":{"start":{"row":10,"column":6},"end":{"row":10,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-7":{"range":{"start":{"row":11,"column":6},"end":{"row":11,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-8":{"range":{"start":{"row":12,"column":6},"end":{"row":12,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-9":{"range":{"start":{"row":13,"column":6},"end":{"row":13,"column":23}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-10":{"range":{"start":{"row":14,"column":6},"end":{"row":14,"column":14}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-11":{"range":{"start":{"row":15,"column":4},"end":{"row":15,"column":6}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-12":{"range":{"start":{"row":17,"column":4},"end":{"row":17,"column":13}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-13":{"range":{"start":{"row":18,"column":6},"end":{"row":18,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-14":{"range":{"start":{"row":19,"column":6},"end":{"row":19,"column":15}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-15":{"range":{"start":{"row":20,"column":6},"end":{"row":20,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-16":{"range":{"start":{"row":21,"column":4},"end":{"row":21,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-17":{"range":{"start":{"row":22,"column":2},"end":{"row":22,"column":3}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-18":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"}},"version":2},"1":{"nextMarkerId":0,"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"nextMarkerId":1,"id":"2","maintainHistory":true,"markersById":{"2-0":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2}},"nextMarkerLayerId":3,"history":{"version":3,"nextCheckpointId":2,"undoStack":[{"type":"checkpoint","id":1,"snapshot":{"2":{"2-0":{"range":[[0,0],[0,0]],"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}}},"isBoundary":false}],"redoStack":[]},"encoding":"utf8","filePath":"/Users/anas/projects/node-server/src/models/userSecret.js","digestWhenLastPersisted":"ada1e2c9cf19bbb6c0aa1db36b95da8dbfe852a2","preferredLineEnding":null,"deserializer":"TextBuffer","version":4},{"text":"\nif(!module.parent) {\n  throw 'Don\\'t run this file directly, run src/main.js instead!';\n}\n\nvar _ = require('underscore');\nvar express = require('express');\nvar session = require('express-session');\nvar bodyParser = require('body-parser');\nvar shortid = require('shortid');\nvar urlLib = require('url');\nvar colors = require('colors/safe');\nvar uid = require('uid-safe').sync;\nvar cors = require('cors');\n\nvar global = pRequire('/global');\nvar orm = pRequire('/orm');\nvar error = pRequire('/lib/error');\nvar log = pRequire('/lib/log');\nvar apiUtil = pRequire('/lib/api-util');\n\nvar app = global.app;\n\nfunction randomColorFunction() {\n  return colors[_.sample([\n    'red', 'green', 'yellow',\n    'blue', 'magenta', 'cyan', 'white'\n  ])];\n}\n\napp.use(cors());\n// app.use(bodyParser.json({ extended: false }));\n\n////\n//// Request logger\n//// Adds a logger that outputs a randomly selected color and an id to every log message.\n\napp.use(function(req, res, next) {\n  var reqId = shortid.generate();\n  req.requestId = reqId;\n\n  var prefix = '';\n  prefix += randomColorFunction()('');\n  prefix += ' ';\n\n  prefix += reqId.replace(/^../, function(match) {\n    return colors.bold(match);\n  });\n\n  prefix += colors.gray(' - ');\n\n  req.logger = log.createLogger('[request]', {\n    prefix: prefix\n  });\n  res.logger = req.logger; // for convenience\n\n  next();\n});\n\n// Log at the beginning and end of every request.\n\napp.use(function(req, res, next) {\n  var parsedUrl = urlLib.parse(req.originalUrl);\n  var logString = '';\n\n  var methodColor = colors.reset;\n\n  if(req.method === 'GET') {\n    methodColor = colors.cyan;\n  } else if(req.method === 'POST') {\n    methodColor = colors.magenta;\n  }\n\n  logString += methodColor(req.method);\n  logString += ' ';\n  logString += colors.bold((parsedUrl.pathname.match(/[^\\/]+$/) || [''])[0]);\n  logString += colors.gray(' - ');\n\n  if(parsedUrl.pathname.match(/^\\/api\\/2.0\\//)) {\n    logString += colors.gray('/api/2.0/');\n  }\n\n  logString +=\n    parsedUrl.pathname\n      .replace(/^\\/api\\/2.0\\//, '')\n      .replace(/\\//g, colors.gray('/'));\n\n  logString += colors.gray(parsedUrl.search || '');\n\n  req.logger.info(logString);\n\n  req.on('end', function() {\n    req.logger.info('Response sent');\n  });\n\n  next();\n});\n\napp.use(require('cookie-parser')());\n\nvar PGStore = require('connect-pg-simple')(session);\nvar pg = require('../lib/pg');\n\napp.use(session({\n  name: 'session_id',\n  secret: global.sessionSecret,\n  cookie: { path: '/', httpOnly: true, secure: false,\n    maxAge:\n      3600000 * // hour\n      24 *      // day\n      30        // month\n  },\n  store: new PGStore({\n    pg: pg,\n    conString: global.credentials.postgres\n  }),\n  resave: true,\n  saveUninitialized: true\n}));\n\nvar passport = require('passport');\n\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(require('connect-timeout')('10m')); // timeout all requests after 10 min\n\napp.get('/', function(req, res, next) {\n  var redirectUrl = null;\n\n  redirectUrl = 'my.scorecloud.com';\n\n  if(req.hostname === 'api.scorecloud.com') {\n    redirectUrl = 'my.scorecloud.com';\n  } else if(req.hostname === 'alpha-api.scorecloud.com') {\n    redirectUrl = 'alpha-my.scorecloud.com';\n  }\n\n  if(redirectUrl) {\n    res.status(301).redirect('https://' + redirectUrl);\n  } else {\n    next();\n  }\n});\n\napp.use('/api/2.0', global.apiApp);\n\nrequire('./routes/admin-routes');\nrequire('./routes/subscription-restrictions');\nrequire('./routes/analysis-routes');\nrequire('./routes/comment-routes');\nrequire('./routes/song-routes');\nrequire('./routes/static-song-routes');\nrequire('./routes/user-routes');\nrequire('./routes/subscription-routes');\nrequire('./routes/like-routes.js');\nrequire('./routes/bookmark-routes.js');\nrequire('./routes/collection-routes.js');\nrequire('./routes/location-routes.js');\nrequire('./routes/notification-routes.js');\nrequire('./routes/flags-routes.js');\nrequire('./routes/goldfish-routes.js');\nrequire('./routes/tag-routes.js');\n\nvar tags = [\n  { name: 'A cappella', cssClass: 'acappella' },\n  { name: 'Ambient' },\n  { name: 'Assignments' },\n  { name: 'Classical' },\n  { name: 'Country' },\n  { name: 'Dance' },\n  { name: 'Electronic' },\n  { name: 'Exercises' },\n  { name: 'Folk' },\n  { name: 'Funk' },\n  { name: 'Game' },\n  { name: 'Choir / Gospel', cssClass: 'choir-gospel' },\n  { name: 'Hip-Hop' },\n  { name: 'Jazz' },\n  { name: 'Latin' },\n  { name: 'Musical' },\n  { name: 'Pop' },\n  { name: 'Reggae' },\n  { name: 'Rock' },\n  { name: 'Soundtrack' },\n  { name: 'Other' }\n];\n\nvar _ = require('underscore');\nvar tagNames = _.pluck(tags, 'name');\n\nglobal.apiApp.get('/tags/genres', function(req, res) {\n  res.json(tagNames);\n});\n\nfunction init(handler) {\n  orm.init(function() {\n    app.use(handler);\n\n    // Handle errors\n    app.use(function(err, req, res, next) {\n      if(err.code === 'ETIMEDOUT') {\n        err = error.serverError({ errorType: 'timeout' });\n      }\n\n      apiUtil.sendError(res, err);\n    });\n\n    app.listen(global.port);\n    log.info('Listening on port ' + global.port);\n  });\n}\nexports.init = init;\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"nextMarkerId":65,"id":"0","maintainHistory":false,"markersById":{"0-0":{"range":{"start":{"row":25,"column":5},"end":{"row":25,"column":8}},"properties":{"type":"pigments-color"},"reversed":false,"tailed":true,"valid":true,"invalidate":"touch"},"0-1":{"range":{"start":{"row":25,"column":12},"end":{"row":25,"column":17}},"properties":{"type":"pigments-color"},"reversed":false,"tailed":true,"valid":true,"invalidate":"touch"},"0-2":{"range":{"start":{"row":25,"column":21},"end":{"row":25,"column":27}},"properties":{"type":"pigments-color"},"reversed":false,"tailed":true,"valid":true,"invalidate":"touch"},"0-3":{"range":{"start":{"row":26,"column":5},"end":{"row":26,"column":9}},"properties":{"type":"pigments-color"},"reversed":false,"tailed":true,"valid":true,"invalidate":"touch"},"0-4":{"range":{"start":{"row":26,"column":13},"end":{"row":26,"column":20}},"properties":{"type":"pigments-color"},"reversed":false,"tailed":true,"valid":true,"invalidate":"touch"},"0-5":{"range":{"start":{"row":26,"column":24},"end":{"row":26,"column":28}},"properties":{"type":"pigments-color"},"reversed":false,"tailed":true,"valid":true,"invalidate":"touch"},"0-6":{"range":{"start":{"row":26,"column":32},"end":{"row":26,"column":37}},"properties":{"type":"pigments-color"},"reversed":false,"tailed":true,"valid":true,"invalidate":"touch"},"0-7":{"range":{"start":{"row":1,"column":0},"end":{"row":1,"column":20}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-8":{"range":{"start":{"row":2,"column":2},"end":{"row":2,"column":66}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-9":{"range":{"start":{"row":24,"column":2},"end":{"row":24,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-10":{"range":{"start":{"row":33,"column":0},"end":{"row":33,"column":4}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-11":{"range":{"start":{"row":34,"column":0},"end":{"row":34,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-12":{"range":{"start":{"row":35,"column":0},"end":{"row":35,"column":89}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-13":{"range":{"start":{"row":37,"column":0},"end":{"row":37,"column":34}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-14":{"range":{"start":{"row":38,"column":2},"end":{"row":38,"column":33}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-15":{"range":{"start":{"row":39,"column":2},"end":{"row":39,"column":24}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-16":{"range":{"start":{"row":41,"column":2},"end":{"row":41,"column":18}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-17":{"range":{"start":{"row":42,"column":2},"end":{"row":42,"column":39}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-18":{"range":{"start":{"row":43,"column":2},"end":{"row":43,"column":16}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-19":{"range":{"start":{"row":45,"column":2},"end":{"row":45,"column":50}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-20":{"range":{"start":{"row":45,"column":2},"end":{"row":45,"column":50}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-21":{"range":{"start":{"row":46,"column":4},"end":{"row":46,"column":30}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-22":{"range":{"start":{"row":47,"column":2},"end":{"row":47,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-23":{"range":{"start":{"row":49,"column":2},"end":{"row":49,"column":31}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-24":{"range":{"start":{"row":51,"column":2},"end":{"row":51,"column":46}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-25":{"range":{"start":{"row":52,"column":4},"end":{"row":52,"column":18}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-26":{"range":{"start":{"row":53,"column":2},"end":{"row":53,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-27":{"range":{"start":{"row":54,"column":2},"end":{"row":54,"column":45}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-28":{"range":{"start":{"row":56,"column":2},"end":{"row":56,"column":9}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-29":{"range":{"start":{"row":61,"column":0},"end":{"row":61,"column":34}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-30":{"range":{"start":{"row":62,"column":2},"end":{"row":62,"column":48}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-31":{"range":{"start":{"row":63,"column":2},"end":{"row":63,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-32":{"range":{"start":{"row":65,"column":2},"end":{"row":65,"column":33}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-33":{"range":{"start":{"row":67,"column":2},"end":{"row":67,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-34":{"range":{"start":{"row":67,"column":2},"end":{"row":67,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-35":{"range":{"start":{"row":68,"column":4},"end":{"row":68,"column":30}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-36":{"range":{"start":{"row":69,"column":2},"end":{"row":69,"column":36}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-37":{"range":{"start":{"row":69,"column":2},"end":{"row":69,"column":36}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-38":{"range":{"start":{"row":69,"column":2},"end":{"row":69,"column":36}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-39":{"range":{"start":{"row":70,"column":4},"end":{"row":70,"column":33}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-40":{"range":{"start":{"row":71,"column":2},"end":{"row":71,"column":3}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-41":{"range":{"start":{"row":73,"column":2},"end":{"row":73,"column":39}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-42":{"range":{"start":{"row":74,"column":2},"end":{"row":74,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-43":{"range":{"start":{"row":75,"column":2},"end":{"row":75,"column":77}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-44":{"range":{"start":{"row":75,"column":2},"end":{"row":75,"column":77}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-45":{"range":{"start":{"row":75,"column":2},"end":{"row":75,"column":77}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-46":{"range":{"start":{"row":76,"column":2},"end":{"row":76,"column":34}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-47":{"range":{"start":{"row":78,"column":2},"end":{"row":78,"column":49}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-48":{"range":{"start":{"row":78,"column":2},"end":{"row":78,"column":49}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-49":{"range":{"start":{"row":79,"column":4},"end":{"row":79,"column":42}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-50":{"range":{"start":{"row":80,"column":2},"end":{"row":80,"column":3}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-51":{"range":{"start":{"row":82,"column":2},"end":{"row":82,"column":14}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-52":{"range":{"start":{"row":87,"column":2},"end":{"row":87,"column":51}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-53":{"range":{"start":{"row":89,"column":2},"end":{"row":89,"column":29}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-54":{"range":{"start":{"row":91,"column":2},"end":{"row":91,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-55":{"range":{"start":{"row":91,"column":2},"end":{"row":91,"column":28}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-56":{"range":{"start":{"row":92,"column":4},"end":{"row":92,"column":37}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-57":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-58":{"range":{"start":{"row":5,"column":4},"end":{"row":5,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-59":{"range":{"start":{"row":15,"column":4},"end":{"row":15,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-60":{"range":{"start":{"row":187,"column":4},"end":{"row":187,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-61":{"range":{"start":{"row":6,"column":4},"end":{"row":6,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-62":{"range":{"start":{"row":8,"column":4},"end":{"row":8,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-63":{"range":{"start":{"row":12,"column":4},"end":{"row":12,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"},"0-64":{"range":{"start":{"row":199,"column":36},"end":{"row":199,"column":37}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside"}},"version":2},"1":{"nextMarkerId":0,"id":"1","maintainHistory":false,"markersById":{},"version":2},"2":{"nextMarkerId":1,"id":"2","maintainHistory":true,"markersById":{"2-0":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2}},"nextMarkerLayerId":3,"history":{"version":3,"nextCheckpointId":2,"undoStack":[{"type":"checkpoint","id":1,"snapshot":{"2":{"2-0":{"range":[[0,0],[0,0]],"properties":{"type":"selection"},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}}},"isBoundary":false}],"redoStack":[]},"encoding":"utf8","filePath":"/Users/anas/projects/node-server/src/server.js","digestWhenLastPersisted":"46cc6e7727cac2cc6a3d443d663939c1cec01fdb","preferredLineEnding":null,"deserializer":"TextBuffer","version":4}]},"workspace":{"deserializer":"Workspace","paneContainer":{"deserializer":"PaneContainer","version":1,"root":{"deserializer":"Pane","id":3,"items":[{"deserializer":"TextEditor","id":194,"softTabs":true,"firstVisibleScreenRow":127,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":195,"softWrapped":true,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/anas/projects/node-server/src/controllers/user-controller.js","tabLength":2,"largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"},{"deserializer":"TextEditor","id":198,"softTabs":true,"firstVisibleScreenRow":99,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":199,"softWrapped":true,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/anas/projects/node-server/src/lib/auth.js","tabLength":2,"largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"},{"deserializer":"TextEditor","id":202,"softTabs":true,"firstVisibleScreenRow":72,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":203,"softWrapped":true,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/anas/projects/node-server/src/managers/user-manager.js","tabLength":2,"largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"},{"deserializer":"TextEditor","id":206,"softTabs":true,"firstVisibleScreenRow":29,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":207,"softWrapped":true,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/anas/projects/node-server/src/models/user.js","tabLength":2,"largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"},{"deserializer":"TextEditor","id":210,"softTabs":true,"firstVisibleScreenRow":0,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":211,"softWrapped":true,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/anas/projects/node-server/src/models/userSecret.js","tabLength":2,"largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"},{"deserializer":"TextEditor","id":214,"softTabs":true,"firstVisibleScreenRow":190,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":215,"softWrapped":true,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/anas/projects/node-server/src/server.js","tabLength":2,"largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"1"},"selectionsMarkerLayerId":"2"}],"activeItemURI":"/Users/anas/projects/node-server/src/server.js","focused":false,"flexScale":1},"activePaneId":3},"packagesWithActiveGrammars":["meteor-api","language-hyperlink","language-todo"],"destroyedItemURIs":["/Users/anas/projects/node-server/src/routes/goldfish-routes.js","/Users/anas/projects/node-server/src/managers/tag-manager.js","/Users/anas/projects/node-server/src/routes/song-routes.js","/Users/anas/projects/node-server/src/routes/tag-routes.js","/Users/anas/projects/node-server/src/controllers/initialize-controller.js"]},"windowDimensions":{"x":0,"y":23,"width":1440,"height":830,"maximized":true},"packageStates":{"atom-typescript":{},"linter":{"scope":"File"},"local-history":{"localHistoryViewState":""},"pigments":{"project":{"deserializer":"ColorProject","timestamp":"2015-12-13T14:14:59.561Z","version":"1.0.1","markersVersion":"1.0.5","globalSourceNames":["**/*.styl","**/*.stylus","**/*.less","**/*.sass","**/*.scss"],"globalIgnoredNames":["vendor/*","node_modules/*","spec/*","test/*"],"buffers":{"194":{"id":194,"path":"/Users/anas/projects/node-server/src/controllers/user-controller.js","colorMarkers":[]},"198":{"id":198,"path":"/Users/anas/projects/node-server/src/lib/auth.js","colorMarkers":[]},"202":{"id":202,"path":"/Users/anas/projects/node-server/src/managers/user-manager.js","colorMarkers":[]},"206":{"id":206,"path":"/Users/anas/projects/node-server/src/models/user.js","colorMarkers":[]},"210":{"id":210,"path":"/Users/anas/projects/node-server/src/models/userSecret.js","colorMarkers":[]},"214":{"id":214,"path":"/Users/anas/projects/node-server/src/server.js","colorMarkers":[{"markerId":"0-0","bufferRange":[[25,5],[25,8]],"color":[255,0,0,1],"text":"red","variables":[]},{"markerId":"0-1","bufferRange":[[25,12],[25,17]],"color":[0,128,0,1],"text":"green","variables":[]},{"markerId":"0-2","bufferRange":[[25,21],[25,27]],"color":[255,255,0,1],"text":"yellow","variables":[]},{"markerId":"0-3","bufferRange":[[26,5],[26,9]],"color":[0,0,255,1],"text":"blue","variables":[]},{"markerId":"0-4","bufferRange":[[26,13],[26,20]],"color":[255,0,255,1],"text":"magenta","variables":[]},{"markerId":"0-5","bufferRange":[[26,24],[26,28]],"color":[0,255,255,1],"text":"cyan","variables":[]},{"markerId":"0-6","bufferRange":[[26,32],[26,37]],"color":[255,255,255,1],"text":"white","variables":[]}]}},"paths":[],"variables":{"deserializer":"VariablesCollection","content":[]}}},"fuzzy-finder":{"/Users/anas/projects/node-server/src/controllers/user-controller.js":1450015760341,"/Users/anas/projects/node-server/src/lib/auth.js":1450015825692,"/Users/anas/projects/node-server/src/managers/user-manager.js":1450015879196,"/Users/anas/projects/node-server/src/models/user.js":1450015920937,"/Users/anas/projects/node-server/src/models/userSecret.js":1450015952057,"/Users/anas/projects/node-server/src/server.js":1450015973174},"metrics":{"sessionLength":383549},"tabs":[{}],"tree-view":{"directoryExpansionStates":{"/Users/anas/projects/node-server":{"isExpanded":true,"entries":{".git":{"isExpanded":false,"entries":{}},"bachjs":{"isExpanded":false,"entries":{}},"bachjs-dist":{"isExpanded":false,"entries":{}},"component":{"isExpanded":false,"entries":{}},"debussy-templates":{"isExpanded":false,"entries":{}},"docs":{"isExpanded":false,"entries":{}},"jobs":{"isExpanded":false,"entries":{}},"lib":{"isExpanded":false,"entries":{}},"load_test":{"isExpanded":false,"entries":{}},"managers":{"isExpanded":false,"entries":{}},"middleware":{"isExpanded":false,"entries":{}},"migration":{"isExpanded":false,"entries":{}},"node_modules":{"isExpanded":false,"entries":{}},"resources":{"isExpanded":false,"entries":{}},"scripts":{"isExpanded":false,"entries":{}},"src":{"isExpanded":true,"entries":{"controllers":{"isExpanded":true,"entries":{"static-song":{"isExpanded":false,"entries":{}}}},"lib":{"isExpanded":true,"entries":{}},"managers":{"isExpanded":true,"entries":{}},"models":{"isExpanded":true,"entries":{}},"record-analysis":{"isExpanded":false,"entries":{}},"routes":{"isExpanded":true,"entries":{}},"scripts":{"isExpanded":false,"entries":{}},"sitemaps":{"isExpanded":false,"entries":{}}}},"static":{"isExpanded":false,"entries":{}},"storage_cache":{"isExpanded":false,"entries":{}},"terms":{"isExpanded":false,"entries":{}},"vivaldi-design":{"isExpanded":false,"entries":{}}}}},"selectedPath":"/Users/anas/projects/node-server/src/server.js","hasFocus":true,"attached":true,"scrollLeft":0,"scrollTop":2481,"width":341},"find-and-replace":{"findOptions":{"findPattern":"emitEnd","replacePattern":"","pathsPattern":"","useRegex":false,"wholeWord":false,"caseSensitive":false,"inCurrentSelection":false},"findHistory":["end","flush","flushend","end","emitEnd"],"replaceHistory":[],"pathsHistory":[]},"keybinding-resolver":{},"livereload":{"activated":false},"term3":{"termViews":[]}},"fullScreen":false}